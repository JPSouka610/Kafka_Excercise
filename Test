import pandas as pd

def clean_market_data(data):
    """
    Limpia y transforma los datos de mercado obtenidos desde la API.

    Args:
        data (dict): Datos de mercado obtenidos desde la API.

    Returns:
        pd.DataFrame: Datos limpios como un DataFrame de Pandas.
    """
    try:
        # Convertir los datos en un DataFrame
        df = pd.DataFrame([data])

        # Verificar que todas las columnas importantes están presentes
        required_columns = ["symbol", "open", "high", "low", "close", "volume", "timestamp"]
        for col in required_columns:
            if col not in df.columns:
                raise ValueError(f"Falta la columna requerida: {col}")

        # Convertir el timestamp a formato de fecha y hora
        df["timestamp"] = pd.to_datetime(df["timestamp"], unit="s")

        # Validar que los valores numéricos no sean nulos o negativos
        numeric_columns = ["open", "high", "low", "close", "volume"]
        for col in numeric_columns:
            if (df[col] <= 0).any():
                raise ValueError(f"Los valores de '{col}' no pueden ser negativos o cero.")

        print(f"Datos limpios:\n{df}")
        return df

    except Exception as e:
        print(f"Error al limpiar los datos: {e}")
        return None

# Prueba de la función
raw_data = {
    "symbol": "BTCUSDT",
    "open": 27345.67,
    "high": 27378.9,
    "low": 27340.1,
    "close": 27350.55,
    "volume": 1234.5678,
    "timestamp": 1679445782.0
}

cleaned_data = clean_market_data(raw_data)

